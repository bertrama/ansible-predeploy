- name: add the brightbox repo
  apt_repository:
    repo: "{{brightbox}}"
    state: present

- name: super-ugly hack to allow unauthenticated packages to install
  copy: content='APT::Get::AllowUnauthenticated "true";' dest=/etc/apt/apt.conf.d/99temp owner=root group=root mode=0644

- name: install ruby
  apt:
    name: "{{item}}"
    state: latest
    #allow_unauthenticated: yes # allowed in 2.1
  with_items:
    - ruby2.3
    - ruby2.3-dev
    - ruby-switch

- name: remove hack that allows unauthenticated packages to install
  file: path=/etc/apt/apt.conf.d/99temp state=absent

- name: set ruby to 2.3
  command: "ruby-switch --set ruby2.3"

- name: disable documentation
  lineinfile:
    create: yes
    state: present
    dest: /etc/gemrc
    insertafter: EOF
    line: "gem: --no-ri --no-rdoc"
    mode: 0644
    owner: root

- name: install gems
  gem:
    name: "{{item}}"
    state: latest
  with_items:
    - bundler
    - rake