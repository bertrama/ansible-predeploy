- hosts: development
  become: true
  vars:
    rbenv_git: git://github.com/sstephenson/rbenv.git
    rbenv_dir: /usr/local/rbenv
    ruby_build_git: git://github.com/sstephenson/ruby-build.git
    rbenv_profile: /etc/profile.d/rbenv.sh
    version: 2.2.1

  tasks:
    - name: install ruby development package dependencies
      apt:
        pkg: "{{item}}"
        state: installed
      with_items:
        - autoconf
        - bison
        - build-essential
        - libssl-dev
        - git
        - libyaml-dev
        - libreadline6-dev
        - zlib1g-dev
        - libsqlite3-dev
        - libncurses5-dev
        - libffi-dev
        - libgdbm3
        - libgdbm-dev

    - name: download rbenv from git
      git:
        accept_hostkey: true
        repo: "{{rbenv_git}}"
        dest: "{{rbenv_dir}}"

    - name: set rbenv permissions
      file:
        path: "{{rbenv_dir}}"
        mode: "o+rsXx"

    - name: create rbenv profile
      template:
        src: ./rbenv.sh.j2
        owner: root
        group: root
        mode: "u=rw,go=rx"
        dest: "{{rbenv_profile}}"